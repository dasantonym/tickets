/*! NondescriptTicketSoftware cordova - v0.3.0 - 2017-06-29 */

angular.module("tickets.directives.utils",[]).directive("stringToNumber",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return""+a}),d.$formatters.push(function(a){return parseFloat(a)})}}}),angular.module("tickets.services.heartbeat",[]).factory("App.Heartbeat",["$http",function(a){return{target:null,interval:5e3,timeout:null,status:null,setup:function(a,b){this.target=a,this.interval=b||5e3},start:function(){function b(){a.get(c.target).then(function(a){c.status=200===a.status,c.timeout=setTimeout(b,c.interval)},function(){c.status=!1,c.timeout=setTimeout(b,c.interval)})}if("string"==typeof this.target){this.stop();var c=this;b()}},stop:function(){this.timeout&&clearTimeout(this.timeout)}}}]),function(){"use strict";angular.module("ticket-scanner",["ui.bootstrap","ngRoute","cgBusy","tickets.controllers.tickets","tickets.services.settings","tickets.services.heartbeat"]).config(["$routeProvider","$locationProvider","$logProvider",function(a,b,c){c.debugEnabled(!0);var d="./partials/";a.when("/",{templateUrl:d+"scan.html",controller:"Tickets.Scan"}),a.when("/settings",{templateUrl:d+"settings.html",controller:"Tickets.Settings"}),a.otherwise({redirectTo:"/"})}]).run(["$rootScope","$q","App.Settings","$location","App.Heartbeat",function(a,b,c,d,e){a.$applyAsync(function(){a.remote={ip:c.remote.ip},a.goto=function(a){d.path(a)},a.heartbeat=e,"string"==typeof c.remote.ip&&(a.heartbeat.setup("http://"+c.remote.ip+":9999/api/heartbeat.json"),a.heartbeat.start())}),a.$on("$routeChangeStart",function(){a.pageDefer&&(a.pageDefer.resolve(),a.pageDefer=null),a.pageDefer=b.defer(),a.pagePromise=a.pageDefer.promise}),a.$on("$routeChangeSuccess",function(){a.pageDefer&&(a.pageDefer.resolve(),a.pageDefer=null)}),a.$on("$routeChangeError",function(){a.pageDefer&&(a.pageDefer.reject(),a.pageDefer=null)})}])}(),function(){"use strict";angular.module("tickets.controllers.tickets",[]).controller("Tickets.Scan",["$scope","$rootScope","$q","$routeParams","App.Settings","$http",function(a,b,c,d,e,f){a.settings=e,a.heartbeat=b.heartbeat,a.scan=function(){"string"!=typeof e.remote.ip&&a.$applyAsync(function(){a.alerts=[{type:"danger",msg:"Set target in settings first."}]}),cordova.plugins.barcodeScanner.scan(function(b){b.cancelled||f({method:"POST",url:"http://"+e.remote.ip+":9999/api/tickets/void.json",data:{token:b.text},headers:{"Content-Type":"application/json"}}).then(function(b){b.data.success?a.$applyAsync(function(){a.alerts=[{type:"success",msg:"Ticket is valid",ticket:b.data.ticket}]}):a.$applyAsync(function(){a.alerts=[{type:"danger",msg:b.data.error,ticket:b.data.ticket}]})},function(b){var c;switch(b.status){case 401:c="Ticket was already claimed at "+ticket.void_at;break;case 402:c=b.data.ticket?"Ticket not fully paid: €"+b.data.ticket.order_amount_paid+" of €"+b.data.ticket.order_amount_due:"Ticket payment incomplete";break;case 403:c="Ticket invalid";break;case 404:c="Ticket unknown";break;case 500:c="Internal Error";break;default:c||(c="Request failed with status "+b.status)}c&&a.$applyAsync(function(){a.alerts=[{type:"danger",msg:c}]})})},function(b){a.$applyAsync(function(){a.alerts=[{type:"danger",msg:"Scan failed: "+b.message}]})})}}]).controller("Tickets.Settings",["$scope","$q","$routeParams","App.Settings","$rootScope",function(a,b,c,d,e){a.remote={ip:d.remote.ip},a.submit=function(){d.storeRemote(a.remote.ip),e.$applyAsync(function(){e.remote={ip:a.remote.ip}}),a.alerts=[{type:"success",msg:"Settings saved"}]}}])}();var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(a){console.log("Received Event: "+a)}};angular.module("tickets.services.settings",[]).factory("App.Settings",["$rootScope",function(a){return{remote:{ip:localStorage["remote.ip"]},storeRemote:function(b){this.remote.ip=b,localStorage["remote.ip"]=this.remote.ip,a.remote.ip=b,a.heartbeat.setup("http://"+b+":9999/api/heartbeat.json"),a.heartbeat.start()}}}]);